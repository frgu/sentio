<!DOCTYPE html>
<html>
<head>
	<title>Extended Static timeline without filter. Basic Example.</title>

	<link rel="stylesheet" href="../../../dist/sentio.css" />

	<script src="../../../node_modules/d3/build/d3.js" charset="utf-8"></script>
	<script src="../../../dist/sentio.js" charset="utf-8"></script>

	<style>
	</style>

</head>
<body>
	<div id="chart"></div>
	<button onclick="updateData()">Update Data</button>
	<button onclick="stackData()">Stack Plots</button>
	<button onclick="lockYAxis()">Lock Y Axis</button>

	<script type="text/javascript">

		var stack = false;
		var lockY = false;
		var lockStackOverrideStore = 0;
		var timelineDiv = d3.select('#chart');
		var timeline = sentio.chart.timeline()
			.height(500)
			.width(600)
			.autoColor(true);

		var yExtent = sentio.model.extent({
			getValue: function(d) { return d[1]; }
		});

		var multiExtent = sentio.model.multiExtent()
					.values(function(d) { return d.data; })
					.extent(yExtent);

		var hwm = Date.now();
		var data = [];
		var series = 0;

		timeline.init(timelineDiv);
		timeline.data(data);
        timeline.yAxis().ticks(10);
		timeline.yExtent().overrideValue([0, undefined]);
		updateData();

		function generateData(start, samples){
			var toReturn = [];
			for(var i=0; i<samples; i++){
				toReturn.push([start + i*1000, Math.random() * 10]);
			}
			return toReturn;
		}

		function updateData() {

			data.push({ key: 'series' + series++, opacity: stack ? '1' : '0.1', values: generateData(hwm - 1000*15, 15) });
			// data.push({ key: 'series' + series++, opacity: '1', data: generateData(hwm - 1000*15, 15) });
			// data[0] = { key: 'series' + series++, opacity: stack ? '1' : '0.1', data: generateData(hwm - 1000*15, 15) };

			// Append stacked data
			data.reverse().forEach(function(d, i) {
				d.values.forEach(function(point, j) {
					point[2] = i === 0 ? point[1] : point[1] + data[i-1].values[j][2];
				});
			});
			data.reverse();

			if (lockY) {
				var newExtent = multiExtent.getExtent(timeline.data())[1];
				var currentOverride = timeline.yExtent().overrideValue()[1];
				if (newExtent > currentOverride) {
					timeline.yExtent().overrideValue([0, newExtent]);
				}
			}
			console.log(timeline.data());
			
			timeline.redraw();
		}

		function stackData() {
			stack = !stack;

			var currentExtent = multiExtent.getExtent(timeline.data())[1];

			data.forEach(function(d) {
				d.opacity = stack ? '1' : '0.1';
			});
			timeline.yValue(function(d) {
				return d[stack ? 2 : 1];
			});
			yExtent.getValue(function(d) { 
				return d[stack ? 2 : 1];
			});

			var newExtent = multiExtent.getExtent(timeline.data())[1];

			if (lockY) {
				if (stack) {
					var currentOverride = timeline.yExtent().overrideValue()[1];
					lockStackOverrideStore = currentOverride;
					timeline.yExtent().overrideValue([0, undefined]);
				} else {
					timeline.yExtent().overrideValue([0, lockStackOverrideStore]);
				}
			}

			timeline.redraw();
		}

		function lockYAxis() {
			lockY = !lockY;

			var toSet = lockY ? multiExtent.getExtent(timeline.data())[1] : undefined;
			timeline.yExtent().overrideValue([0, toSet]);
		}

	</script>

</body>
</html>

